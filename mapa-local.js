// mapa-local.js
// Versão local do mapa, sem dependência da API
// Basta importar este arquivo no lugar de mapa.js para rodar em homologação

// ...código JS do mapa copiado de bck.txt...

// Coloque os dados dos andares e áreas aqui:
// Exemplo:
window.andares = [
    {
                nome: '1º Andar',
                imagem: 'pavimento 1.png',
                bounds: [[0, 0], [2080, 3000]],
                segmentos: [
                    {
                        "id": 1,
                        "a": [
                            411.47206641313653,
                            1613.8614744172273
                        ],
                        "b": [
                            412.4726364863378,
                            1507.8898487394958
                        ]
                    },
                    {
                        "id": 2,
                        "a": [
                            412.4726364863378,
                            1507.8898487394958
                        ],
                        "b": [
                            556.5547270273245,
                            1505.890384104067
                        ]
                    },
                    {
                        "id": 3,
                        "a": [
                            556.5547270273245,
                            1505.890384104067
                        ],
                        "b": [
                            646.1057485788405,
                            1504.8906517863525
                        ]
                    },
                    {
                        "id": 4,
                        "a": [
                            646.1057485788405,
                            1504.8906517863525
                        ],
                        "b": [
                            721.6487891055383,
                            1505.890384104067
                        ]
                    },
                    {
                        "id": 5,
                        "a": [
                            721.6487891055383,
                            1505.890384104067
                        ],
                        "b": [
                            818.7040862060641,
                            1494.8933286092079
                        ]
                    },
                    {
                        "id": 6,
                        "a": [
                            818.7040862060641,
                            1494.8933286092079
                        ],
                        "b": [
                            1030.3246566881382,
                            1490.394533179493
                        ]
                    },
                    {
                        "id": 7,
                        "a": [
                            1030.3246566881382,
                            1490.394533179493
                        ],
                        "b": [
                            1034.827222017544,
                            1268.4539586468852
                        ]
                    },
                    {
                        "id": 8,
                        "a": [
                            1034.827222017544,
                            1268.4539586468852
                        ],
                        "b": [
                            1061.842613993979,
                            1178.4780500525849
                        ]
                    },
                    {
                        "id": 9,
                        "a": [
                            1061.842613993979,
                            1178.4780500525849
                        ],
                        "b": [
                            1059.3411888109758,
                            1101.498661588572
                        ]
                    },
                    {
                        "id": 10,
                        "a": [
                            1059.3411888109758,
                            1101.498661588572
                        ],
                        "b": [
                            1060.3417588841771,
                            955.0378770434054
                        ]
                    },
                    {
                        "id": 11,
                        "a": [
                            1060.3417588841771,
                            955.0378770434054
                        ],
                        "b": [
                            1058.840903774375,
                            820.0740141519549
                        ]
                    },
                    {
                        "id": 12,
                        "a": [
                            1058.840903774375,
                            820.0740141519549
                        ],
                        "b": [
                            1146.4101676683326,
                            802.0939564822284
                        ]
                    },
                    {
                        "id": 13,
                        "a": [
                            1146.4101676683326,
                            802.0939564822284
                        ],
                        "b": [
                            1137.9053220461217,
                            1270.468547331448
                        ]
                    },
                    {
                        "id": 14,
                        "a": [
                            1137.9053220461217,
                            1270.468547331448
                        ],
                        "b": [
                            1134.7627579433347,
                            1485.887038075498
                        ]
                    },
                    {
                        "id": 15,
                        "a": [
                            1134.7627579433347,
                            1485.887038075498
                        ],
                        "b": [
                            1047.7131615748222,
                            1574.8632143520838
                        ]
                    },
                    {
                        "id": 16,
                        "a": [
                            1047.7131615748222,
                            1574.8632143520838
                        ],
                        "b": [
                            1030.3246566881382,
                            1490.394533179493
                        ]
                    },
                    {
                        "id": 17,
                        "a": [
                            411.47206641313653,
                            1613.8614744172273
                        ],
                        "b": [
                            549.2847973665106,
                            1616.8120870355433
                        ]
                    },
                    {
                        "id": 18,
                        "a": [
                            549.2847973665106,
                            1616.8120870355433
                        ],
                        "b": [
                            699.6402838099821,
                            1612.6129314150935
                        ]
                    },
                    {
                        "id": 19,
                        "a": [
                            699.6402838099821,
                            1612.6129314150935
                        ],
                        "b": [
                            721.6487891055383,
                            1505.890384104067
                        ]
                    },
                    {
                        "id": 20,
                        "a": [
                            453.9161992394095,
                            2185.6174820139477
                        ],
                        "b": [
                            602.0005700732013,
                            2189.6164112848055
                        ]
                    },
                    {
                        "id": 21,
                        "a": [
                            602.0005700732013,
                            2189.6164112848055
                        ],
                        "b": [
                            851.1425183003239,
                            2186.617214331662
                        ]
                    },
                    {
                        "id": 22,
                        "a": [
                            851.1425183003239,
                            2186.617214331662
                        ],
                        "b": [
                            967.2086467916743,
                            2185.6174820139477
                        ]
                    },
                    {
                        "id": 23,
                        "a": [
                            967.2086467916743,
                            2185.6174820139477
                        ],
                        "b": [
                            974.2126373040833,
                            2098.640770372791
                        ]
                    },
                    {
                        "id": 24,
                        "a": [
                            974.2126373040833,
                            2098.640770372791
                        ],
                        "b": [
                            971.2109270844794,
                            1965.676372116769
                        ]
                    },
                    {
                        "id": 25,
                        "a": [
                            971.2109270844794,
                            1965.676372116769
                        ],
                        "b": [
                            1049.2553927941804,
                            1939.6833318561933
                        ]
                    },
                    {
                        "id": 26,
                        "a": [
                            1049.2553927941804,
                            1939.6833318561933
                        ],
                        "b": [
                            1057.259953379791,
                            2053.6528160756407
                        ]
                    },
                    {
                        "id": 27,
                        "a": [
                            1057.259953379791,
                            2053.6528160756407
                        ],
                        "b": [
                            1060.261663599395,
                            2193.6153405556634
                        ]
                    },
                    {
                        "id": 28,
                        "a": [
                            1060.261663599395,
                            2193.6153405556634
                        ],
                        "b": [
                            1084.275345356226,
                            2212.6102545922377
                        ]
                    },
                    {
                        "id": 29,
                        "a": [
                            1084.275345356226,
                            2212.6102545922377
                        ],
                        "b": [
                            1271.3819490448682,
                            2209.6110576390947
                        ]
                    },
                    {
                        "id": 30,
                        "a": [
                            1271.3819490448682,
                            2209.6110576390947
                        ],
                        "b": [
                            1346.4247045349657,
                            2301.5864308688238
                        ]
                    },
                    {
                        "id": 31,
                        "a": [
                            1346.4247045349657,
                            2301.5864308688238
                        ],
                        "b": [
                            1374.4406665846018,
                            2347.5741174836885
                        ]
                    },
                    {
                        "id": 32,
                        "a": [
                            1374.4406665846018,
                            2347.5741174836885
                        ],
                        "b": [
                            1423.4686001714654,
                            2352.572779072261
                        ]
                    },
                    {
                        "id": 33,
                        "a": [
                            1423.4686001714654,
                            2352.572779072261
                        ],
                        "b": [
                            1485.5039447099457,
                            2375.5666223796934
                        ]
                    },
                    {
                        "id": 34,
                        "a": [
                            1485.5039447099457,
                            2375.5666223796934
                        ],
                        "b": [
                            1572.5535410784587,
                            2375.5666223796934
                        ]
                    },
                    {
                        "id": 35,
                        "a": [
                            1572.5535410784587,
                            2375.5666223796934
                        ],
                        "b": [
                            1663.6054177397764,
                            2360.5706376139765
                        ]
                    },
                    {
                        "id": 36,
                        "a": [
                            1663.6054177397764,
                            2360.5706376139765
                        ],
                        "b": [
                            1663.6054177397764,
                            2309.58428941054
                        ]
                    },
                    {
                        "id": 37,
                        "a": [
                            1663.6054177397764,
                            2309.58428941054
                        ],
                        "b": [
                            1666.6071279593803,
                            2269.5949967019615
                        ]
                    },
                    {
                        "id": 38,
                        "a": [
                            1666.6071279593803,
                            2269.5949967019615
                        ],
                        "b": [
                            1663.6054177397764,
                            2154.6257801648
                        ]
                    },
                    {
                        "id": 39,
                        "a": [
                            1663.6054177397764,
                            2154.6257801648
                        ],
                        "b": [
                            1656.6014272273674,
                            2048.6541544870684
                        ]
                    },
                    {
                        "id": 40,
                        "a": [
                            1047.7131615748222,
                            1574.8632143520838
                        ],
                        "b": [
                            1052.2132073772846,
                            1759.3294863841043
                        ]
                    },
                    {
                        "id": 41,
                        "a": [
                            1052.2132073772846,
                            1759.3294863841043
                        ],
                        "b": [
                            1056.6630867380336,
                            1838.7175951887439
                        ]
                    },
                    {
                        "id": 42,
                        "a": [
                            1056.6630867380336,
                            1838.7175951887439
                        ],
                        "b": [
                            1049.2553927941804,
                            1939.6833318561933
                        ]
                    },
                    {
                        "id": 43,
                        "a": [
                            1101.3266977468058,
                            1650.3848966172131
                        ],
                        "b": [
                            1047.7131615748222,
                            1574.8632143520838
                        ]
                    },
                    {
                        "id": 44,
                        "a": [
                            1134.7627579433347,
                            1485.887038075498
                        ],
                        "b": [
                            1101.3266977468058,
                            1650.3848966172131
                        ]
                    },
                    {
                        "id": 45,
                        "a": [
                            1134.7627579433347,
                            1485.887038075498
                        ],
                        "b": [
                            1238.8495006748576,
                            1514.8434058629525
                        ]
                    },
                    {
                        "id": 46,
                        "a": [
                            1238.8495006748576,
                            1514.8434058629525
                        ],
                        "b": [
                            1265.8648926512924,
                            1602.8198498218242
                        ]
                    },
                    {
                        "id": 47,
                        "a": [
                            1265.8648926512924,
                            1602.8198498218242
                        ],
                        "b": [
                            1389.935581728253,
                            1624.813960811542
                        ]
                    },
                    {
                        "id": 48,
                        "a": [
                            1389.935581728253,
                            1624.813960811542
                        ],
                        "b": [
                            1409.9469831922793,
                            1691.79602609841
                        ]
                    },
                    {
                        "id": 49,
                        "a": [
                            1409.9469831922793,
                            1691.79602609841
                        ],
                        "b": [
                            1564.0347744652786,
                            1707.7917431818414
                        ]
                    },
                    {
                        "id": 50,
                        "a": [
                            1564.0347744652786,
                            1707.7917431818414
                        ],
                        "b": [
                            1605.0581474665319,
                            1822.7609597190028
                        ]
                    },
                    {
                        "id": 51,
                        "a": [
                            1605.0581474665319,
                            1822.7609597190028
                        ],
                        "b": [
                            1657.0877912729993,
                            1871.747843287011
                        ]
                    },
                    {
                        "id": 52,
                        "a": [
                            1657.0877912729993,
                            1871.747843287011
                        ],
                        "b": [
                            1656.6014272273674,
                            2048.6541544870684
                        ]
                    },
                    {
                        "id": 53,
                        "a": [
                            967.2086467916743,
                            2185.6174820139477
                        ],
                        "b": [
                            1060.261663599395,
                            2193.6153405556634
                        ]
                    },
                    {
                        "id": 54,
                        "a": [
                            1243.1376726781132,
                            1353.9048389474865
                        ],
                        "b": [
                            1137.9053220461217,
                            1270.468547331448
                        ]
                    },
                    {
                        "id": 55,
                        "a": [
                            1220.624846031084,
                            841.0421599599742
                        ],
                        "b": [
                            1146.4101676683326,
                            802.0939564822284
                        ]
                    },
                    {
                        "id": 56,
                        "a": [
                            1039.5216627816492,
                            825.5463090354003
                        ],
                        "b": [
                            1058.840903774375,
                            820.0740141519549
                        ]
                    },
                    {
                        "id": 57,
                        "a": [
                            1030.5165321228376,
                            951.5125810674209
                        ],
                        "b": [
                            1060.3417588841771,
                            955.0378770434054
                        ]
                    },
                    {
                        "id": 58,
                        "a": [
                            1028.0151069398344,
                            1103.471893360017
                        ],
                        "b": [
                            1059.3411888109758,
                            1101.498661588572
                        ]
                    },
                    {
                        "id": 59,
                        "a": [
                            1001.5,
                            1288.9222382960475
                        ],
                        "b": [
                            1034.827222017544,
                            1268.4539586468852
                        ]
                    },
                    {
                        "id": 60,
                        "a": [
                            984.9905937921786,
                            1438.8820859532148
                        ],
                        "b": [
                            1030.3246566881382,
                            1490.394533179493
                        ]
                    },
                    {
                        "id": 61,
                        "a": [
                            818.8959616407634,
                            1439.381952112072
                        ],
                        "b": [
                            818.7040862060641,
                            1494.8933286092079
                        ]
                    },
                    {
                        "id": 62,
                        "a": [
                            733.8475054186532,
                            1440.3816844297864
                        ],
                        "b": [
                            721.6487891055383,
                            1505.890384104067
                        ]
                    },
                    {
                        "id": 63,
                        "a": [
                            640.7944886109326,
                            1457.8769999897893
                        ],
                        "b": [
                            646.1057485788405,
                            1504.8906517863525
                        ]
                    },
                    {
                        "id": 64,
                        "a": [
                            560.2485977182282,
                            1445.880212177216
                        ],
                        "b": [
                            556.5547270273245,
                            1505.890384104067
                        ]
                    },
                    {
                        "id": 65,
                        "a": [
                            371.6411389197839,
                            1468.3741893257911
                        ],
                        "b": [
                            412.4726364863378,
                            1507.8898487394958
                        ]
                    },
                    {
                        "id": 66,
                        "a": [
                            381.6468396517969,
                            1658.8231958503936
                        ],
                        "b": [
                            411.47206641313653,
                            1613.8614744172273
                        ]
                    },
                    {
                        "id": 67,
                        "a": [
                            531.2320655953906,
                            1701.3118193532578
                        ],
                        "b": [
                            549.2847973665106,
                            1616.8120870355433
                        ]
                    },
                    {
                        "id": 68,
                        "a": [
                            426.8475054186532,
                            2130.3364461235283
                        ],
                        "b": [
                            453.9161992394095,
                            2185.6174820139477
                        ]
                    },
                    {
                        "id": 69,
                        "a": [
                            595.9438477896723,
                            2135.8349738709576
                        ],
                        "b": [
                            602.0005700732013,
                            2189.6164112848055
                        ]
                    },
                    {
                        "id": 70,
                        "a": [
                            891.1120193840547,
                            2150.3310924778175
                        ],
                        "b": [
                            851.1425183003239,
                            2186.617214331662
                        ]
                    },
                    {
                        "id": 71,
                        "a": [
                            904.6197153722723,
                            1984.875393896076
                        ],
                        "b": [
                            971.2109270844794,
                            1965.676372116769
                        ]
                    },
                    {
                        "id": 72,
                        "a": [
                            1594.1815683146128,
                            2059.9408422148936
                        ],
                        "b": [
                            1656.6014272273674,
                            2048.6541544870684
                        ]
                    },
                    {
                        "id": 73,
                        "a": [
                            1603.1866989734247,
                            2160.4139401451957
                        ],
                        "b": [
                            1663.6054177397764,
                            2154.6257801648
                        ]
                    },
                    {
                        "id": 74,
                        "a": [
                            1599.1844186806195,
                            2308.874189325791
                        ],
                        "b": [
                            1663.6054177397764,
                            2309.58428941054
                        ]
                    },
                    {
                        "id": 75,
                        "a": [
                            1391.0658434547497,
                            2297.377267672075
                        ],
                        "b": [
                            1346.4247045349657,
                            2301.5864308688238
                        ]
                    },
                    {
                        "id": 76,
                        "a": [
                            1109.9056528851854,
                            2175.909791069769
                        ],
                        "b": [
                            1084.275345356226,
                            2212.6102545922377
                        ]
                    },
                    {
                        "id": 77,
                        "a": [
                            1098.899382079971,
                            2055.9419129440357
                        ],
                        "b": [
                            1057.259953379791,
                            2053.6528160756407
                        ]
                    },
                    {
                        "id": 78,
                        "a": [
                            1102.9016623727764,
                            1936.9737671360162
                        ],
                        "b": [
                            1049.2553927941804,
                            1939.6833318561933
                        ]
                    },
                    {
                        "id": 79,
                        "a": [
                            1107.4042277021822,
                            1814.506558215996
                        ],
                        "b": [
                            1056.6630867380336,
                            1838.7175951887439
                        ]
                    },
                    {
                        "id": 80,
                        "a": [
                            1135.4201897518185,
                            1696.5381447256912
                        ],
                        "b": [
                            1101.3266977468058,
                            1650.3848966172131
                        ]
                    }
                ],
                areas: [
                    {
                        nome: "Loja 1",
                        categoria: "Alimentação",
                        subcategoria: "Cafeteria",
                        coord: [
                            [
                                611.8027546723515,
                                1356.7748791978515
                            ],
                            [
                                503.93714942955705,
                                1367.9431175143204
                            ],
                            [
                                502.68643683805544,
                                1494.6591887846268
                            ],
                            [
                                610.9981472620958,
                                1494.1593226257696
                            ]
                        ],
                        label: [
                            1243.1376726781132,
                            1353.9048389474865
                        ],
                        cor: "#f0f0f0",
                        popup: "Área importada do aa.txt",
                        icon: "mapa.png"
                    },
                    {
                        nome: "Loja 2",
                        categoria: "Vestuário",
                        subcategoria: "",
                        coord: [
                            [
                                1374.291757861995,
                                777.7388242645783
                            ],
                            [
                                1364.7863421665827,
                                777.9887573440069
                            ],
                            [
                                1365.2866272031833,
                                804.7315968428684
                            ],
                            [
                                1375.042185416896,
                                805.4813960811542
                            ],
                            [
                                1374.291757861995,
                                926.6989396040312
                            ],
                            [
                                1325.2638242751314,
                                928.1985380806028
                            ],
                            [
                                1325.764109311732,
                                1107.1506229514894
                            ],
                            [
                                1158.6942753445733,
                                1106.9223721371902
                            ],
                            [
                                1166.4454154909758,
                                776.4721610423027
                            ],
                            [
                                1356.7197861203313,
                                776.4372954246097
                            ]
                        ],
                        label: [
                            1220.624846031084,
                            841.0421599599742
                        ],
                        cor: "#f0f0f0",
                        popup: "Área importada do aa.txt",
                        icon: "mapa.png"
                    },
                    {
                        nome: "Loja 3",
                        categoria: "Alimentação",
                        subcategoria: "Restaurante",
                        coord: [
                            [
                                1052.3799881405114,
                                760.6066972237254
                            ],
                            [
                                991.1017695170472,
                                760.4816972237254
                            ],
                            [
                                971.9658668670724,
                                877.8252780154589
                            ],
                            [
                                977.7276958859993,
                                878.4800911300122
                            ],
                            [
                                977.477553367699,
                                882.2290873214413
                            ],
                            [
                                1052.368016603284,
                                881.6042880831556
                            ]
                        ],
                        label: [
                            1039.5216627816492,
                            825.5463090354003
                        ],
                        cor: "#f0f0f0",
                        popup: "Área importada do aa.txt",
                        icon: "mapa.png"
                    },
                    {
                        nome: "Loja 4",
                        categoria: "Serviços",
                        subcategoria: "Banco",
                        coord: [
                            [
                                1052.0002137774504,
                                886.0537334051483
                            ],
                            [
                                971.0717295920927,
                                885.9493450182657
                            ],
                            [
                                947.5921407036822,
                                1034.0684094196647
                            ],
                            [
                                1051.9637198121216,
                                1033.7977097838823
                            ]
                        ],
                        label: [
                            1030.5165321228376,
                            951.5125810674209
                        ],
                        cor: "#f0f0f0",
                        popup: "Área importada do aa.txt",
                        icon: "mapa.png"
                    },
                    {
                        nome: "Loja 5",
                        categoria: "Alimentação",
                        subcategoria: "Lanchonete",
                        coord: [
                            [
                                1052.3746437042491,
                                1038.12282508143
                            ],
                            [
                                962.2512802299017,
                                1037.6015207928226
                            ],
                            [
                                940.103007280022,
                                1175.041921738073
                            ],
                            [
                                1004.3896344832053,
                                1175.9166875160731
                            ],
                            [
                                1003.8893494466047,
                                1170.2931932289293
                            ],
                            [
                                1052.6671405151678,
                                1170.1682266892149
                            ]
                        ],
                        label: [
                            1028.0151069398344,
                            1103.471893360017
                        ],
                        cor: "#f0f0f0",
                        popup: "Área importada do aa.txt",
                        icon: "mapa.png"
                    },
                    {
                        nome: "Loja 6",
                        categoria: "Serviços",
                        subcategoria: "Correios",
                        coord: [
                            [
                                1023.9959382284408,
                                1180.60402040087
                            ],
                            [
                                924.9395009815124,
                                1180.229120781727
                            ],
                            [
                                900.0860925040115,
                                1337.0784902028854
                            ],
                            [
                                1024.2558432503133,
                                1336.7200865045897
                            ]
                        ],
                        label: [
                            1001.5,
                            1288.9222382960475
                        ],
                        cor: "#f0f0f0",
                        popup: "Área importada do aa.txt",
                        icon: "mapa.png"
                    },
                    {
                        nome: "Loja 7",
                        categoria: "Alimentação",
                        subcategoria: "Cafeteria",
                        coord: [
                            [
                                1023.9893111274757,
                                1341.7070369931691
                            ],
                            [
                                898.838942870018,
                                1342.6049238285837
                            ],
                            [
                                898.838942870018,
                                1350.9776819894423
                            ],
                            [
                                872.573978448484,
                                1351.1026485291566
                            ],
                            [
                                872.4507398838539,
                                1479.1595051154318
                            ],
                            [
                                1024.4123197513009,
                                1479.2844716551463
                            ]
                        ],
                        label: [
                            984.9905937921786,
                            1438.8820859532148
                        ],
                        cor: "#f0f0f0",
                        popup: "Área importada do aa.txt",
                        icon: "mapa.png"
                    },
                    {
                        nome: "Loja 8",
                        categoria: "Alimentação",
                        subcategoria: "Restaurante",
                        coord: [
                            [
                                862.9970427452682,
                                1478.6054926534405
                            ],
                            [
                                863.6223990410191,
                                1343.5166632222756
                            ],
                            [
                                778.1814429722363,
                                1347.6721082685808
                            ],
                            [
                                778.4331195563085,
                                1478.7871862412958
                            ],
                            [
                                861.8666983090061,
                                1478.6758558205786
                            ]
                        ],
                        label: [
                            818.8959616407634,
                            1439.381952112072
                        ],
                        cor: "#f0f0f0",
                        popup: "Área importada do aa.txt",
                        icon: "mapa.png"
                    },
                    {
                        nome: "Loja 9",
                        categoria: "Alimentação",
                        subcategoria: "Lanchonete",
                        coord: [
                            [
                                773.7321852124595,
                                1348.355325352012
                            ],
                            [
                                685.5569475115952,
                                1352.104321543441
                            ],
                            [
                                686.3373751687144,
                                1494.8457557103036
                            ],
                            [
                                740.6183016398847,
                                1494.9707222500178
                            ],
                            [
                                739.9677701866852,
                                1478.8985123089333
                            ],
                            [
                                773.090258301642,
                                1478.6455343435066
                            ]
                        ],
                        label: [
                            733.8475054186532,
                            1440.3816844297864
                        ],
                        cor: "#f0f0f0",
                        popup: "Área importada do aa.txt",
                        icon: "mapa.png"
                    },
                    {
                        nome: "Loja 10",
                        categoria: "Alimentação",
                        subcategoria: "Restaurante",
                        coord: [
                            [
                                680.3739043905663,
                                1494.5269796310383
                            ],
                            [
                                680.6813004539359,
                                1352.1775121047203
                            ],
                            [
                                613.0160012127045,
                                1355.7402986689121
                            ],
                            [
                                613.5505640923478,
                                1494.8009394712928
                            ]
                        ],
                        label: [
                            640.7944886109326,
                            1457.8769999897893
                        ],
                        cor: "#f0f0f0",
                        popup: "Área importada do aa.txt",
                        icon: "mapa.png"
                    },
                    {
                        nome: "Loja 11",
                        categoria: "Serviços",
                        subcategoria: "Banco",
                        coord: [
                            [
                                607.8502374453187,
                                1494.3029470884344
                            ],
                            [
                                608.8746035714449,
                                1356.2031448212406
                            ],
                            [
                                504.21232465397117,
                                1367.0380183197972
                            ],
                            [
                                504.02818648516825,
                                1494.717855156834
                            ]
                        ],
                        label: [
                            560.2485977182282,
                            1445.880212177216
                        ],
                        cor: "#f0f0f0",
                        popup: "Área importada do aa.txt",
                        icon: "mapa.png"
                    },
                    {
                        nome: "Loja 12",
                        categoria: "Serviços",
                        subcategoria: "Correios",
                        coord: [
                            [
                                499.99992874084984,
                                1367.4826341117248
                            ],
                            [
                                338.78307569629095,
                                1384.228150433442
                            ],
                            [
                                410.78327022348253,
                                929.1731685537634
                            ],
                            [
                                145.46589059451418,
                                969.4862888126246
                            ],
                            [
                                74.46238720333656,
                                1406.1542346776005
                            ],
                            [
                                226.59150819942383,
                                1388.5985663743018
                            ],
                            [
                                251.2764199378545,
                                1558.2041519427648
                            ],
                            [
                                401.17306178282774,
                                1558.4268953744438
                            ],
                            [
                                401.07729680171474,
                                1494.5925806105345
                            ],
                            [
                                499.8616766386329,
                                1494.177712255944
                            ]
                        ],
                        label: [
                            371.6411389197839,
                            1468.3741893257911
                        ],
                        cor: "#f0f0f0",
                        popup: "Área importada do aa.txt",
                        icon: "mapa.png"
                    },
                    {
                        nome: "Loja 13",
                        categoria: "Serviços",
                        subcategoria: "Banco",
                        coord: [
                            [
                                252.24237874291055,
                                1563.737476733623
                            ],
                            [
                                258.9962267370193,
                                1602.9769702039152
                            ],
                            [
                                325.03385156830484,
                                1593.4795131856279
                            ],
                            [
                                325.7842791232058,
                                1881.652353766818
                            ],
                            [
                                463.86294922498473,
                                1881.9022868462464
                            ],
                            [
                                463.71209013211376,
                                1629.4553639788844
                            ],
                            [
                                401.6767455936334,
                                1629.4553639788844
                            ],
                            [
                                401.1764605570328,
                                1563.4730310097307
                            ]
                        ],
                        label: [
                            381.6468396517969,
                            1658.8231958503936
                        ],
                        cor: "#f0f0f0",
                        popup: "Área importada do aa.txt",
                        icon: "mapa.png"
                    },
                    {
                        nome: "Loja 14",
                        categoria: "Serviços",
                        subcategoria: "Banco",
                        coord: [
                            [
                                468.2085271746057,
                                1629.7012149034583
                            ],
                            [
                                629.8005939966151,
                                1628.2016164268866
                            ],
                            [
                                630.551021551516,
                                1728.1748481983316
                            ],
                            [
                                606.2871972763846,
                                1728.9246474366175
                            ],
                            [
                                606.2871972763846,
                                1874.885565822927
                            ],
                            [
                                577.7709501901477,
                                1874.3856996640698
                            ],
                            [
                                577.5208076718474,
                                1882.3835582057854
                            ],
                            [
                                467.45809961970474,
                                1882.3835582057854
                            ]
                        ],
                        label: [
                            531.2320655953906,
                            1701.3118193532578
                        ],
                        cor: "#f0f0f0",
                        popup: "Área importada do aa.txt",
                        icon: "mapa.png"
                    },
                    {
                        nome: "Loja 15",
                        categoria: "Serviços",
                        subcategoria: "Banco",
                        coord: [
                            [
                                325.84585500758374,
                                1887.3491686594443
                            ],
                            [
                                497.4425651249694,
                                1887.1995418891736
                            ],
                            [
                                496.18786202105866,
                                2174.4182230617644
                            ],
                            [
                                438.4049402936838,
                                2173.918356902907
                            ],
                            [
                                438.4049402936838,
                                2236.6515598394885
                            ],
                            [
                                366.1137525048901,
                                2237.651292157203
                            ],
                            [
                                324.5900944670363,
                                1935.4821991280107
                            ]
                        ],
                        label: [
                            426.8475054186532,
                            2130.3364461235283
                        ],
                        cor: "#f0f0f0",
                        popup: "Área importada do aa.txt",
                        icon: "mapa.png"
                    },
                    {
                        nome: "Loja 16",
                        categoria: "Serviços",
                        subcategoria: "Banco",
                        coord: [
                            [
                                501.3171375700683,
                                1887.1202151791458
                            ],
                            [
                                606.6845841001513,
                                2056.4070473263423
                            ],
                            [
                                690.2321852124594,
                                2056.4070473263423
                            ],
                            [
                                689.9820426941591,
                                2173.8755946577903
                            ],
                            [
                                501.8748689323154,
                                2173.8755946577903
                            ]
                        ],
                        label: [
                            595.9438477896723,
                            2135.8349738709576
                        ],
                        cor: "#f0f0f0",
                        popup: "Área importada do aa.txt",
                        icon: "mapa.png"
                    },
                    {
                        nome: "Loja 17",
                        categoria: "Serviços",
                        subcategoria: "Banco",
                        coord: [
                            [
                                731.0747622991357,
                                2055.8604113154374
                            ],
                            [
                                731.199833558286,
                                2174.078757885171
                            ],
                            [
                                943.6959028544111,
                                2173.4539251865995
                            ],
                            [
                                942.9454752995102,
                                2057.235043252295
                            ]
                        ],
                        label: [
                            891.1120193840547,
                            2150.3310924778175
                        ],
                        cor: "#f0f0f0",
                        popup: "Área importada do aa.txt",
                        icon: "mapa.png"
                    },
                    {
                        nome: "Loja 18",
                        categoria: "Serviços",
                        subcategoria: "Banco",
                        coord: [
                            [
                                730.9355817282535,
                                2051.4490065246027
                            ],
                            [
                                731.185724246554,
                                1968.9710903131604
                            ],
                            [
                                750.6968406739792,
                                1970.7206218691608
                            ],
                            [
                                749.6962706007779,
                                1947.7267785617285
                            ],
                            [
                                732.4364368380554,
                                1947.976711641157
                            ],
                            [
                                731.185724246554,
                                1917.4848759508664
                            ],
                            [
                                915.5407602338928,
                                1918.4846082685808
                            ],
                            [
                                943.0564372469285,
                                1919.2344075068665
                            ],
                            [
                                942.5561522103278,
                                2057.1974673514605
                            ]
                        ],
                        label: [
                            904.6197153722723,
                            1984.875393896076
                        ],
                        cor: "#f0f0f0",
                        popup: "Área importada do aa.txt",
                        icon: "mapa.png"
                    },
                    {
                        nome: "Loja 19",
                        categoria: "Serviços",
                        subcategoria: "Banco",
                        coord: [
                            [
                                1512.5155344947352,
                                2010.6993411274595
                            ],
                            [
                                1512.0152494581346,
                                2099.425584324617
                            ],
                            [
                                1643.5902140841051,
                                2100.1753835629024
                            ],
                            [
                                1641.5890739377026,
                                2010.949274206888
                            ]
                        ],
                        label: [
                            1594.1815683146128,
                            2059.9408422148936
                        ],
                        cor: "#f0f0f0",
                        popup: "Área importada do aa.txt",
                        icon: "mapa.png"
                    },
                    {
                        nome: "Loja 20",
                        categoria: "Serviços",
                        subcategoria: "Banco",
                        coord: [
                            [
                                1512.3087175397336,
                                2103.9350201251827
                            ],
                            [
                                1643.4434800433057,
                                2104.0931458080195
                            ],
                            [
                                1643.568551302456,
                                2203.6914779603217
                            ],
                            [
                                1512.0793941438963,
                                2204.095421107447
                            ]
                        ],
                        label: [
                            1603.1866989734247,
                            2160.4139401451957
                        ],
                        cor: "#f0f0f0",
                        popup: "Área importada do aa.txt",
                        icon: "mapa.png"
                    },
                    {
                        nome: "Loja 21",
                        categoria: "Serviços",
                        subcategoria: "Banco",
                        coord: [
                            [
                                1467.7193585654304,
                                2207.9637625105934
                            ],
                            [
                                1643.1243558204517,
                                2207.746422277327
                            ],
                            [
                                1642.989026090875,
                                2345.971491836589
                            ],
                            [
                                1467.2654709879848,
                                2345.7823492267016
                            ]
                        ],
                        label: [
                            1599.1844186806195,
                            2308.874189325791
                        ],
                        cor: "#f0f0f0",
                        popup: "Área importada do aa.txt",
                        icon: "mapa.png"
                    },
                    {
                        nome: "Loja 22",
                        categoria: "Serviços",
                        subcategoria: "Banco",
                        coord: [
                            [
                                1462.8183195432016,
                                2235.6823640458706
                            ],
                            [
                                1369.01487518058,
                                2235.9322971252996
                            ],
                            [
                                1370.0154452537815,
                                2315.6609494630266
                            ],
                            [
                                1462.3180345066012,
                                2315.9108825424555
                            ]
                        ],
                        label: [
                            1391.0658434547497,
                            2297.377267672075
                        ],
                        cor: "#f0f0f0",
                        popup: "Área importada do aa.txt",
                        icon: "mapa.png"
                    },
                    {
                        nome: "Loja 23",
                        categoria: "Serviços",
                        subcategoria: "Banco",
                        coord: [
                            [
                                1323.2238299100868,
                                2195.9614744944247
                            ],
                            [
                                1075.582736792766,
                                2195.4616083355672
                            ],
                            [
                                1076.0830218293665,
                                2108.48489669441
                            ],
                            [
                                1322.9736873917866,
                                2107.7350974561245
                            ]
                        ],
                        label: [
                            1109.9056528851854,
                            2175.909791069769
                        ],
                        cor: "#f0f0f0",
                        popup: "Área importada do aa.txt",
                        icon: "mapa.png"
                    },
                    {
                        nome: "Loja 24",
                        categoria: "Serviços",
                        subcategoria: "Banco",
                        coord: [
                            [
                                1322.987627546545,
                                2103.611291654637
                            ],
                            [
                                1323.4879125831458,
                                1994.7654355634768
                            ],
                            [
                                1075.5475916527887,
                                1995.6478510718116
                            ],
                            [
                                1076.0801961401567,
                                2103.9172366685098
                            ]
                        ],
                        label: [
                            1098.899382079971,
                            2055.9419129440357
                        ],
                        cor: "#f0f0f0",
                        popup: "Área importada do aa.txt",
                        icon: "mapa.png"
                    },
                    {
                        nome: "Loja 25",
                        categoria: "Serviços",
                        subcategoria: "Banco",
                        coord: [
                            [
                                1322.7511045168276,
                                1990.9211546504384
                            ],
                            [
                                1075.4283431992042,
                                1990.9828181432963
                            ],
                            [
                                1075.6092517278141,
                                1882.2341732848668
                            ],
                            [
                                1323.4790498098523,
                                1881.725741292872
                            ]
                        ],
                        label: [
                            1102.9016623727764,
                            1936.9737671360162
                        ],
                        cor: "#f0f0f0",
                        popup: "Área importada do aa.txt",
                        icon: "mapa.png"
                    },
                    {
                        nome: "Loja 26",
                        categoria: "Serviços",
                        subcategoria: "Banco",
                        coord: [
                            [
                                1222.466080644523,
                                1878.2246036431584
                            ],
                            [
                                1075.435439209953,
                                1878.3325388974545
                            ],
                            [
                                1075.935724246554,
                                1741.369211370575
                            ],
                            [
                                1222.622363411444,
                                1749.621503400145
                            ]
                        ],
                        label: [
                            1107.4042277021822,
                            1814.506558215996
                        ],
                        cor: "#f0f0f0",
                        popup: "Área importada do aa.txt",
                        icon: "mapa.png"
                    },
                    {
                        nome: "Loja 27",
                        categoria: 'elevador',
                        coord: [
                            [
                                1222.235035578466,
                                1744.8678729591472
                            ],
                            [
                                1115.338136098205,
                                1745.3407213554092
                            ],
                            [
                                1114.3375660250038,
                                1659.8636081908237
                            ],
                            [
                                1222.3991339307438,
                                1661.3632066673954
                            ]
                        ],
                        label: [
                            1135.4201897518185,
                            1696.5381447256912
                        ],
                        cor: "#f0f0f0",
                        popup: "Área importada do aa.txt",
                        icon: "mapa.png"
                    }
                ] 
            }
];
window.andares.push({
    nome: 'Andar Teste Elevador',
    imagem: 'mapa.png',
    bounds: [[0,0],[1000,1000]],
    segmentos: [
        { id: 1, a: [200, 200], b: [500, 500] },
        { id: 2, a: [500, 500], b: [800, 800] }
    ],
    areas: [
        {
            nome: 'Sala Teste',
            categoria: 'Sala',
            coord: [[190,190],[210,190],[210,210],[190,210]],
            label: [200, 200],
            cor: '#aaf',
            popup: 'Área de teste para navegação até o elevador',
            icon: 'mapa.png'
        },
        {
            nome: 'Elevador Teste',
            categoria: 'elevador',
            coord: [[780,780],[820,780],[820,820],[780,820]], // quadrado como polígono
            label: [800, 800],
            cor: '#ccc',
            popup: 'Elevador de teste',
            icon: 'mapa.png'
        }
    ]
});

// Exemplo de área de elevador correta para teste
window.andares.push({
    nome: 'Andar Elevador Teste',
    imagem: 'mapa.png',
    bounds: [[0,0],[1000,1000]],
    segmentos: [
        { id: 1, a: [200, 200], b: [800, 800] }
    ],
    areas: [
        {
            nome: 'Sala Teste',
            categoria: 'Sala',
            coord: [[190,190],[210,190],[210,210],[190,210]],
            label: [200, 200],
            cor: '#aaf',
            popup: 'Área de teste para navegação até o elevador',
            icon: 'mapa.png'
        },
        {
            nome: 'Elevador Teste',
            categoria: 'elevador',
            coord: [[780,780],[820,780],[820,820],[780,820]], // quadrado como polígono
            label: [800, 800],
            cor: '#ccc',
            popup: 'Elevador de teste',
            icon: 'mapa.png'
        }
    ]
});

// Inicialização do mapa
(function inicializarMapaLocal() {
    const andarSelect = document.getElementById('andarSelect');
        const categoriaSelect = document.getElementById('categoriaSelect');

        // Sidebar responsiva: abrir/fechar no mobile
        const sidebar = document.getElementById('sidebar');
        const menuBtn = document.getElementById('menuBtn');
        function openSidebar() {
            sidebar.classList.add('open');
        }
        function closeSidebar() {
            sidebar.classList.remove('open');
        }
        menuBtn.onclick = () => {
            sidebar.classList.toggle('open');
            if (sidebar.classList.contains('open')) {
                desenharAndar(currentAndarIdx);
            }
        };
        document.getElementById('closeSidebar').onclick = closeSidebar;
        // Fecha sidebar ao navegar (mobile)
        document.getElementById('navegarBtn').onclick = function() {
            // ...existing code...
            if (window.innerWidth <= 600) closeSidebar();
        };
        // Fecha sidebar ao simular (mobile)
        document.getElementById('simularBtn').onclick = function() {
            if (window.innerWidth <= 600) closeSidebar();
        };
        // Abre sidebar automaticamente em desktop
        if (window.innerWidth > 600) openSidebar();

        document.getElementById('navegarBtn').onclick = () => {
            const origemNome = document.getElementById('origem').value;
            const destinoNome = document.getElementById('destino').value;
            const areasAndar = andares[currentAndarIdx].areas;
            const areaOrigem = areasAndar.find(a => a.nome === origemNome);
            const areaDestino = areasAndar.find(a => a.nome === destinoNome);
            if (!areaOrigem || !areaDestino) {
                alert('Selecione áreas válidas para origem e destino!');
                return;
            }
            const coordOrigem = areaOrigem.label;
            const coordDestino = areaDestino.label;
            const caminho = buscarCaminho(coordOrigem, coordDestino);
            destacarCaminho(caminho);
        };

        // Inicializa o mapa sem camada base
        const map = L.map('map', {
            crs: L.CRS.Simple,
            minZoom: -5
        });

        let overlayImg = null;
        let areaObjs = [], labelObjs = [], polyObjs = {};
        let currentAndarIdx = 0;
        let currentGraph = null, currentNodes = null, currentSegmentos = null;
        let labelMarkers = [];
        const LABEL_ZOOM_THRESHOLD = 0; // ajuste conforme necessário
        let routeMarkers = [];
        let categoriaMarkers = [];

        function desenharAndar(idx) {
            const andar = andares[idx];
            currentAndarIdx = Number(idx);
            currentSegmentos = andar.segmentos;
            currentNodes = getUniqueNodes(currentSegmentos);
            currentGraph = buildGraph(currentSegmentos, currentNodes);
            // Remove overlays anteriores
            if (overlayImg) map.removeLayer(overlayImg);
            overlayImg = L.imageOverlay(andar.imagem, andar.bounds).addTo(map);
            // Remove áreas e labels anteriores
            areaObjs.forEach(a => map.removeLayer(a));
            labelObjs.forEach(l => map.removeLayer(l));
            Object.values(polyObjs).forEach(p => map.removeLayer(p));
            areaObjs = []; labelObjs = []; polyObjs = {}; labelMarkers = [];
            // Desenha áreas
            andar.areas.forEach((a, i) => {
                let area, label;
              
                    area = L.polygon(a.coord, { color: 'transparent', weight: 3, fillColor: a.cor, fillOpacity: 0.5 }).addTo(map);
                
                if (area) {
                    area.on('click', function () {
                        areaObjs.forEach(a2 => a2.setStyle({ color: 'transparent' }));
                        area.setStyle({ color: 'red' });
                        map.setView(a.label, map.getZoom(), { animate: true });
                        L.popup({ className: 'custom-popup' })
                            .setLatLng(a.label)
                            .setContent(`
                              <div class="popup-content">
                                <img src="${a.icon}" class="popup-icon" alt="Ícone">
                                <div><b>${a.nome}</b><br>${a.popup || ''}<br>
                                  <span class="popup-rota" style="color:#0070d1;cursor:pointer;font-weight:bold;">ROTA</span>
                                </div>
                              </div>
                            `)
                            .openOn(map);
                        // Adiciona ação ao texto ROTA
                        setTimeout(() => {
                            const rotaEl = document.querySelector('.popup-rota');
                            if (rotaEl) {
                                rotaEl.onclick = function() {
                                    document.getElementById('destino').value = `${a.nome} [${andares[currentAndarIdx].nome}]`;
                                    document.getElementById('destino').dispatchEvent(new Event('input'));
                                    L.popup().remove();
                                };
                            }
                        }, 100);
                    });
                    areaObjs.push(area);
                }
                label = L.marker(a.label, {
                    icon: L.divIcon({ className: 'label', html: `<b>${a.nome}</b>`, iconSize: [80, 20] }),
                    interactive: false
                });
                labelMarkers.push(label);
            });
            // Desenha segmentos (inicialmente invisíveis)
            andar.segmentos.forEach(seg => {
                const poly = L.polyline([seg.a, seg.b], {
                    color: '#bbb', weight: 4, opacity: 0, interactive: false
                }).addTo(map);
                polyObjs[seg.id] = poly;
            });
            updateLabelsVisibility();
        }

        function updateLabelsVisibility() {
            const show = map.getZoom() >= LABEL_ZOOM_THRESHOLD;
            labelMarkers.forEach(label => {
                if (show) {
                    if (!map.hasLayer(label)) label.addTo(map);
                } else {
                    if (map.hasLayer(label)) map.removeLayer(label);
                }
            });
        }

        map.on('zoomend', updateLabelsVisibility);

        andarSelect.onchange = function () {
            // Remove tudo do mapa antes de desenhar o novo andar
            if (overlayImg) map.removeLayer(overlayImg);
            areaObjs.forEach(a => map.removeLayer(a));
            labelObjs.forEach(l => map.removeLayer(l));
            Object.values(polyObjs).forEach(p => map.removeLayer(p));
            // Remove marcadores de rota e categoria ao trocar de andar
            routeMarkers.forEach(m => map.removeLayer(m));
            routeMarkers = [];
            categoriaMarkers.forEach(m => map.removeLayer(m));
            categoriaMarkers = [];
            areaObjs = []; labelObjs = []; polyObjs = {};
            desenharAndar(this.value);
        };
        desenharAndar(0);

        // Funções de navegação para o andar selecionado
        function dist(a, b) {
            return Math.sqrt((a[0] - b[0]) ** 2 + (a[1] - b[1]) ** 2);
        }
        function getUniqueNodes(segmentos) {
            const nodes = [];
            segmentos.forEach(seg => {
                if (!nodes.some(n => n[0] === seg.a[0] && n[1] === seg.a[1])) nodes.push(seg.a);
                if (!nodes.some(n => n[0] === seg.b[0] && n[1] === seg.b[1])) nodes.push(seg.b);
            });
            return nodes;
        }
        function buildGraph(segmentos, nodes) {
            const graph = {};
            nodes.forEach(n => graph[nodeKey(n)] = []);
            segmentos.forEach(seg => {
                const aKey = nodeKey(seg.a);
                const bKey = nodeKey(seg.b);
                const custo = dist(seg.a, seg.b);
                graph[aKey].push({ to: bKey, segId: seg.id, custo });
                graph[bKey].push({ to: aKey, segId: seg.id, custo });
            });
            return graph;
        }
        function nodeKey(pt) { return pt[0] + ',' + pt[1]; }
        function nearestNode(pt, nodes) {
            let min = Infinity, nearest = null;
            nodes.forEach(n => {
                const d = dist(pt, n);
                if (d < min) { min = d; nearest = n; }
            });
            return nearest;
        }

        function convertImageCoordsToLeaflet(points, imageHeight) {
            return points.map(([x, y]) => [imageHeight - y, x]);
        }
        function dijkstra(graph, startKey, endKey, segmentos) {
            const dist = {}, prev = {}, visited = new Set(), queue = [];
            Object.keys(graph).forEach(k => dist[k] = Infinity);
            dist[startKey] = 0;
            queue.push({ key: startKey, dist: 0 });
            while (queue.length) {
                queue.sort((a, b) => a.dist - b.dist);
                const { key } = queue.shift();
                if (visited.has(key)) continue;
                visited.add(key);
                if (key === endKey) break;
                graph[key].forEach(({ to, segId, custo }) => {
                    if (visited.has(to)) return;
                    const alt = dist[key] + custo;
                    if (alt < dist[to]) {
                        dist[to] = alt;
                        prev[to] = { from: key, segId };
                        queue.push({ key: to, dist: alt });
                    }
                });
            }
            let path = [];
            let u = endKey;
            while (prev[u]) {
                path.unshift(prev[u].segId);
                u = prev[u].from;
            }
            return path.map(id => currentSegmentos.find(s => s.id === id));
        }
        function buscarCaminho(origem, destino) {
            const start = nearestNode(origem, currentNodes);
            const end = nearestNode(destino, currentNodes);
            const startKey = nodeKey(start);
            const endKey = nodeKey(end);
            return dijkstra(currentGraph, startKey, endKey, currentSegmentos);
        }
        function destacarCaminho(caminho, origem, destino) {
            Object.values(polyObjs).forEach(poly => poly.setStyle({ color: '#bbb', opacity: 0 }));
            caminho.forEach(seg => {
                if (polyObjs[seg.id]) {
                    polyObjs[seg.id].setStyle({ color: 'orange', opacity: 1, weight: 6 });
                    polyObjs[seg.id].bringToFront();
                }
            });
            // Remove pins anteriores
            routeMarkers.forEach(m => map.removeLayer(m));
            routeMarkers = [];
            // Ícone boneco "banheiro" para origem
            const origemIcon = L.icon({
                iconUrl: 'https://www.svgrepo.com/show/308152/walking-person-go-walk-move.svg', // boneco banheiro
                iconSize: [32, 32],
                iconAnchor: [16, 32],
                popupAnchor: [0, -32]
            });
            if (origem) {
                const markerOrigem = L.marker(origem, { title: 'Origem', icon: origemIcon }).addTo(map);
                routeMarkers.push(markerOrigem);
            }
            if (destino) {
                // Usa o ícone padrão do Leaflet (pin)
                const markerDestino = L.marker(destino, { title: 'Destino' }).addTo(map);
                routeMarkers.push(markerDestino);
            }
        }
        // Atualiza o evento do botão navegar para usar o elevador se necessário
        const navegarBtn = document.getElementById('navegarBtn');
        let aguardandoTransicaoAndar = false;
        let transicaoDestino = null;
        let transicaoDestinoLabel = null;
        let transicaoAreaDestino = null;
        let transicaoTransferDestino = null;
        let transicaoAndarDestino = null;
        let btnCheguei = null;

        navegarBtn.onclick = () => {
            if (aguardandoTransicaoAndar) return; // Evita múltiplos cliques
            const origemInput = document.getElementById('origem').value;
            const destinoInput = document.getElementById('destino').value;
            const areaOrigem = findAreaByInput(origemInput);
            const areaDestino = findAreaByInput(destinoInput);
            if (!areaOrigem || !areaDestino) {
                alert('Selecione áreas válidas para origem e destino!');
                return;
            }
            if (areaOrigem.andar === areaDestino.andar) {
                // Mesmo andar: caminho direto
                if (currentAndarIdx !== areaOrigem.andar) {
                    andarSelect.value = areaOrigem.andar;
                    desenharAndar(areaOrigem.andar);
                }
                const caminho = buscarCaminho(areaOrigem.label, areaDestino.label);
                destacarCaminho(caminho, areaOrigem.label, areaDestino.label);
            } else {
                // Andares diferentes: prioriza elevador
                const transferOrigem = findNearestElevadorArea(areaOrigem.andar, areaOrigem.label) || findNearestTransferArea(areaOrigem.andar, areaOrigem.label);
                const transferDestino = findNearestElevadorArea(areaDestino.andar, areaDestino.label) || findNearestTransferArea(areaDestino.andar, areaDestino.label);
                if (!transferOrigem || !transferDestino) {
                    alert('Não há elevador ou escada em um dos andares!');
                    return;
                }
                // 1º trecho: andar de origem
                if (currentAndarIdx !== areaOrigem.andar) {
                    andarSelect.value = areaOrigem.andar;
                    desenharAndar(areaOrigem.andar);
                }
                const caminho1 = buscarCaminho(areaOrigem.label, transferOrigem.label);
                destacarCaminho(caminho1, areaOrigem.label, transferOrigem.label);
                // Prepara transição para o segundo andar
                aguardandoTransicaoAndar = true;
                transicaoDestino = areaDestino;
                transicaoDestinoLabel = areaDestino.label;
                transicaoAreaDestino = areaDestino;
                transicaoTransferDestino = transferDestino;
                transicaoAndarDestino = areaDestino.andar;
                // Cria botão "Cheguei no andar"
                if (!btnCheguei) {
                    btnCheguei = document.createElement('button');
                    btnCheguei.textContent = 'Cheguei no andar';
                    btnCheguei.style.position = 'fixed';
                    btnCheguei.style.bottom = '30px';
                    btnCheguei.style.right = '30px';
                    btnCheguei.style.zIndex = 3000;
                    btnCheguei.style.background = '#0070d1';
                    btnCheguei.style.color = '#fff';
                    btnCheguei.style.fontSize = '18px';
                    btnCheguei.style.padding = '14px 28px';
                    btnCheguei.style.border = 'none';
                    btnCheguei.style.borderRadius = '24px';
                    btnCheguei.style.boxShadow = '2px 2px 12px #0002';
                    btnCheguei.style.cursor = 'pointer';
                    btnCheguei.onclick = function() {
                        // Troca para o segundo andar e mostra o caminho
                        andarSelect.value = transicaoAndarDestino;
                        desenharAndar(transicaoAndarDestino);
                        const caminho2 = buscarCaminho(transicaoTransferDestino.label, transicaoDestinoLabel);
                        destacarCaminho(caminho2, transicaoTransferDestino.label, transicaoDestinoLabel);
                        aguardandoTransicaoAndar = false;
                        btnCheguei.remove();
                    };
                }
                document.body.appendChild(btnCheguei);
            }
        };


        // Monta lista global de áreas para autocomplete (com andar)
        function getAllAreasWithAndar() {
            const all = [];
            andares.forEach((andar, idx) => {
                andar.areas.forEach(area => {
                    all.push({
                        nome: area.nome,
                        andar: idx,
                        andarNome: andar.nome,
                        categoria: area.categoria, // agora só categoria
                        label: area.label
                    });
                });
            });
            return all;
        }

        function atualizarDatalistsGlobal() {
            const allAreas = getAllAreasWithAndar();
           
            const origemDatalist = document.getElementById('origemList');
            const destinoDatalist = document.getElementById('destinoList');
            origemDatalist.innerHTML = '';
            destinoDatalist.innerHTML = '';
            allAreas.forEach(a => {
                const opt1 = document.createElement('option');
                opt1.value = `${a.nome} [${a.andarNome}]`;
                origemDatalist.appendChild(opt1);
                const opt2 = document.createElement('option');
                opt2.value = `${a.nome} [${a.andarNome}]`;
                destinoDatalist.appendChild(opt2);
            });
        }
        atualizarDatalistsGlobal();

        // Preenche datalist de busca lateral
        function atualizarDatalistBuscaLateral() {
            const allAreas = getAllAreasWithAndar();
            const buscaList = document.getElementById('areaBuscaList');
            buscaList.innerHTML = '';
            allAreas.forEach(a => {
                const opt = document.createElement('option');
                opt.value = `${a.nome} [${a.andarNome}]`;
                buscaList.appendChild(opt);
            });
        }
        atualizarDatalistBuscaLateral();
        // Seleciona área ao escolher na busca lateral
        document.getElementById('areaBuscaSelect').addEventListener('change', function() {
            const val = this.value;
            const area = getAllAreasWithAndar().find(a => `${a.nome} [${a.andarNome}]` === val);
            if (!area) return;
            if (currentAndarIdx !== area.andar) {
                andarSelect.value = area.andar;
                desenharAndar(area.andar);
            }
            setTimeout(() => {
                const idx = andares[area.andar].areas.findIndex(a2 => a2.nome === area.nome);
                if (idx >= 0 && areaObjs[idx]) {
                    areaObjs[idx].fire('click');
                    map.setView(area.label, Math.max(map.getZoom(), 1), { animate: true });
                }
            }, 300);
        });

        // Função para buscar área pelo nome+andar
        function findAreaByInput(inputValue) {
            const allAreas = getAllAreasWithAndar();
            // inputValue: 'Sala A [1º Andar]'
            return allAreas.find(a => `${a.nome} [${a.andarNome}]` === inputValue);
        }

        // Função para buscar escada/elevador mais próxima
        function findNearestTransferArea(andarIdx, fromLabel) {
            const areas = andares[andarIdx].areas;
            // Considera categoria 'escada' ou 'elevador'
            const transferAreas = areas.filter(a => a.categoria && (a.categoria.toLowerCase() === 'escada' || a.categoria.toLowerCase() === 'elevador'));
            if (transferAreas.length === 0) return null;
            let min = Infinity, nearest = null;
            transferAreas.forEach(a => {
                const d = dist(fromLabel, a.label);
                if (d < min) { min = d; nearest = a; }
            });
            return nearest;
        }

        // Função para buscar elevador mais próximo
        function findNearestElevadorArea(andarIdx, fromLabel) {
            const areas = andares[andarIdx].areas;
            const elevadores = areas.filter(a => a.categoria && a.categoria.toLowerCase() === 'elevador');
            if (elevadores.length === 0) return null;
            let min = Infinity, nearest = null;
            elevadores.forEach(a => {
                const d = dist(fromLabel, a.label);
                if (d < min) { min = d; nearest = a; }
            });
            return nearest;
        }

        // Define os bounds do PNG (ajuste conforme o tamanho da sua imagem)
        const bounds = [[0, 0], [1000, 1000]];

        // Ajusta o mapa para mostrar toda a imagem
        map.fitBounds(bounds);

        // Carrega opções de andares
        function carregarAndares() {
            andarSelect.innerHTML = '';
            andares.forEach((andar, idx) => {
                const opt = document.createElement('option');
                opt.value = idx;
                opt.textContent = andar.nome;
                andarSelect.appendChild(opt);
            });
        }

        // Carrega opções de categorias únicas
        function carregarCategorias() {
            const categorias = new Set();
            andares.forEach(andar => {
                andar.areas.forEach(area => {
                    if (area.categoria) categorias.add(area.categoria);
                });
            });
            categoriaSelect.innerHTML = '<option value="">Filtrar por categoria</option>';
            categorias.forEach(cat => {
                const opt = document.createElement('option');
                opt.value = cat;
                opt.textContent = cat;
                categoriaSelect.appendChild(opt);
            });
        }

        // Chama ao iniciar
        carregarAndares();
        carregarCategorias();

        categoriaSelect.onchange = function () {
            // Remove marcadores antigos
            categoriaMarkers.forEach(m => map.removeLayer(m));
            categoriaMarkers = [];
            const cat = categoriaSelect.value;
            // Procura se o andar atual tem a categoria
            const areasNoAndar = andares[currentAndarIdx].areas.filter(area => area.categoria === cat);
            let andarComCategoria = currentAndarIdx;
            if (cat && areasNoAndar.length === 0) {
                // Procura o primeiro andar que tenha a categoria
                for (let i = 0; i < andares.length; i++) {
                    if (andares[i].areas.some(area => area.categoria === cat)) {
                        andarComCategoria = i;
                        break;
                    }
                }
                if (andarComCategoria !== currentAndarIdx) {
                    andarSelect.value = andarComCategoria;
                    desenharAndar(andarComCategoria);
                }
            }
            // Destaca áreas da categoria no andar selecionado
            let bounds = [];
            areaObjs.forEach((areaObj, idx) => {
                const areaData = andares[andarComCategoria].areas[idx];
                const label = areaData.label;
                const labelValido = Array.isArray(label) && label.length === 2 &&
                    typeof label[0] === 'number' && typeof label[1] === 'number' &&
                    !isNaN(label[0]) && !isNaN(label[1]);
                if (cat && areaData.categoria === cat && labelValido) {
                    areaObj.setStyle({ color: 'red', weight: 4 });
                    bounds.push(label);
                } else {
                    areaObj.setStyle({ color: 'transparent', weight: 3 });
                }
            });
            if (bounds.length === 1) {
                map.setView(bounds[0], map.getZoom(), { animate: true });
            } else if (bounds.length > 1) {
                map.fitBounds(bounds, { padding: [40, 40] });
            }
            if (!cat) return;
            andares[andarComCategoria].areas.forEach((area, idx) => {
                const label = area.label;
                const labelValido = Array.isArray(label) && label.length === 2 &&
                    typeof label[0] === 'number' && typeof label[1] === 'number' &&
                    !isNaN(label[0]) && !isNaN(label[1]);
                if (area.categoria === cat && labelValido) {
                    const marker = L.marker(label, {
                        title: area.nome + (area.subcategoria ? ' - ' + area.subcategoria : '')
                    }).addTo(map);
                    categoriaMarkers.push(marker);
                }
            });
        };

        // Abre/fecha a sidebar no mobile
        // const menuBtn = document.getElementById('menuBtn');
        menuBtn.onclick = () => {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('open');
            if (sidebar.classList.contains('open')) {
                // Desenha o andar atual na abertura da sidebar
                desenharAndar(currentAndarIdx);
            } else {
                // Limpa o mapa ao fechar (opcional)
                // areaObjs.forEach(a => map.removeLayer(a));
                // labelObjs.forEach(l => map.removeLayer(l));
                // Object.values(polyObjs).forEach(p => map.removeLayer(p));
                // areaObjs = []; labelObjs = []; polyObjs = {};
            }
        };
})();
